# PageTalk 划词助手功能

## 📋 功能概述

PageTalk 划词助手是一个强大的文本选择增强功能，允许用户在网页上选中文本后快速调用 AI 进行解读、翻译或对话。

### 🌟 核心功能

1. **解读功能** - AI 对选中文本进行深度解读和分析
2. **翻译功能** - 智能中英文互译
3. **对话功能** - 基于选中文本进行多轮对话
4. **自定义选项** - 用户可添加自定义的 AI 处理选项

### 🎨 设计特色

- **毛玻璃效果** - 现代化的视觉设计
- **极简主义** - 简洁优雅的用户界面
- **流畅动画** - 平滑的交互体验
- **响应式设计** - 适配不同屏幕尺寸

## 🚀 使用方法

### 基本使用流程

1. **选中文本** - 在网页上用鼠标选中任意文本
2. **点击图标** - 在选中文本右下角出现的 PageTalk mini icon
3. **选择功能** - 在弹出的选项栏中选择"解读"、"翻译"或"对话"
4. **查看结果** - 在功能窗口中查看 AI 的处理结果

### 功能窗口操作

- **拖拽移动** - 点击窗口标题栏拖拽移动窗口
- **调整大小** - 拖拽窗口边缘调整大小
- **复制结果** - 点击复制按钮复制 AI 响应
- **重新生成** - 点击重新生成按钮获取新的 AI 响应

## ⚙️ 设置配置

### 访问设置

1. 打开 PageTalk 主面板
2. 点击底部的"设置"标签
3. 选择"划词助手"子标签

### 解读设置

- **模型选择** - 选择用于解读的 AI 模型
- **系统提示词** - 自定义解读的指令（默认："解读一下"）
- **温度参数** - 控制 AI 响应的创造性（默认：0.7）

### 翻译设置

- **模型选择** - 选择用于翻译的 AI 模型
- **系统提示词** - 自定义翻译的指令（默认："翻译一下"）
- **温度参数** - 控制翻译的一致性（默认：0.2）

### 自定义选项

- **添加选项** - 创建自定义的 AI 处理选项
- **编辑选项** - 修改现有的自定义选项
- **删除选项** - 移除不需要的自定义选项
- **调整顺序** - 拖拽调整选项在选项栏中的显示顺序

## 🔧 技术实现

### 文件结构

```
js/
├── text-selection-helper.js          # 核心功能模块
├── text-selection-helper-settings.js # 设置管理模块
└── content.js                        # 内容脚本集成

css/
└── text-selection-helper.css         # 样式文件

html/
└── sidepanel.html                     # 设置面板UI
```

### 核心模块

1. **文本选择检测** - 监听用户的文本选择行为
2. **UI 组件系统** - Mini icon、选项栏、功能窗口
3. **AI API 集成** - 调用现有的 Gemini API 系统
4. **设置管理** - 持久化存储用户配置
5. **国际化支持** - 中英文界面切换

### 排除规则

划词助手在以下情况下不会显示：
- 密码输入框内的文本选择
- PageTalk 插件界面内的文本选择
- 其他不适合的元素（script、style 等）

## 🧪 测试指南

### 测试页面

项目根目录下的 `test-page.html` 提供了完整的测试环境，包含：
- 中文测试文本
- 英文测试文本
- 技术术语测试
- 代码片段测试
- 功能验证清单

### 测试步骤

1. 在浏览器中打开 `test-page.html`
2. 确保 PageTalk 扩展已安装并启用
3. 按照页面上的说明进行功能测试
4. 使用开发者工具查看控制台日志

### 调试信息

所有划词助手相关的日志都以 `[TextSelectionHelper]` 前缀显示，便于调试和问题排查。

## 🎯 开发计划

### 已完成功能

- ✅ 基础文本选择检测
- ✅ Mini icon 和选项栏 UI
- ✅ 解读和翻译功能窗口
- ✅ 对话功能窗口
- ✅ 设置面板集成
- ✅ AI API 集成
- ✅ 毛玻璃效果和动画
- ✅ 国际化支持

### 待优化功能

- 🔄 自定义选项的完整编辑界面
- 🔄 更丰富的 SVG 图标库
- 🔄 拖拽排序的视觉反馈
- 🔄 错误处理和重试机制
- 🔄 性能优化和内存管理

### 未来扩展

- 📋 更多预设选项（总结、提问等）
- 📋 快捷键支持
- 📋 选择历史记录
- 📋 批量处理功能
- 📋 导出功能增强

## 🐛 已知问题

1. **API 调用** - 需要确保 GeminiAPI 模块已正确加载
2. **样式兼容** - 某些网站的 CSS 可能影响显示效果
3. **性能优化** - 大量文本选择时的性能待优化

## 📞 支持与反馈

如果在使用过程中遇到问题或有改进建议，请：
1. 检查浏览器控制台的错误信息
2. 确认 PageTalk 扩展的版本和设置
3. 提供详细的复现步骤和环境信息

---

**注意**: 划词助手功能需要有效的 Gemini API Key 才能正常工作。请确保在 PageTalk 设置中正确配置了 API Key。
