# PageTalk 多供应商支持测试计划

## 测试概述

本文档描述了 PageTalk 多供应商支持功能的全面测试计划，确保所有供应商的 API Key 验证、模型发现、聊天、流式输出和错误处理功能正常工作。

## 测试环境准备

### 1. 供应商 API Keys 准备
- [ ] Google Gemini API Key
- [ ] OpenAI API Key  
- [ ] Anthropic Claude API Key
- [ ] SiliconFlow API Key
- [ ] OpenRouter API Key
- [ ] DeepSeek API Key

### 2. 浏览器环境
- [ ] Chrome 浏览器（最新版本）
- [ ] Edge 浏览器（最新版本）
- [ ] 开发者工具准备就绪

## 核心功能测试

### 1. 数据迁移测试

#### 1.1 旧版本兼容性测试
- [ ] 从旧版本（单一 Gemini API Key）升级
- [ ] 验证旧 API Key 自动迁移到 Google 供应商设置
- [ ] 验证旧模型列表正确迁移
- [ ] 验证所有旧模型添加 providerId 字段

#### 1.2 版本号检查
- [ ] 验证版本号从 1.0.0 升级到 2.0.0
- [ ] 验证迁移只执行一次
- [ ] 验证旧存储键被正确清理

### 2. 供应商配置测试

#### 2.1 Google Gemini
- [ ] API Key 输入和保存
- [ ] API Key 可见性切换
- [ ] 连接测试功能
- [ ] 模型发现功能
- [ ] 默认模型正确加载

#### 2.2 OpenAI
- [ ] API Key 配置
- [ ] 连接测试
- [ ] 模型列表获取
- [ ] 模型添加到管理列表

#### 2.3 Anthropic Claude
- [ ] API Key 配置
- [ ] 连接测试
- [ ] 预定义模型列表显示
- [ ] 模型选择和激活

#### 2.4 SiliconFlow
- [ ] API Key 配置
- [ ] OpenAI 兼容 API 测试
- [ ] 模型发现
- [ ] 中文界面支持

#### 2.5 OpenRouter
- [ ] API Key 配置
- [ ] 特殊请求头设置验证
- [ ] 模型聚合服务测试
- [ ] 多模型选择

#### 2.6 DeepSeek
- [ ] API Key 配置
- [ ] 连接测试
- [ ] 模型发现
- [ ] 中文模型支持

### 3. 用户界面测试

#### 3.1 供应商选择界面
- [ ] 供应商下拉框正确显示
- [ ] 供应商切换功能
- [ ] 供应商图标正确显示
- [ ] 供应商描述信息

#### 3.2 配置界面
- [ ] 每个供应商的配置区域
- [ ] API Key 输入框
- [ ] 测试连接按钮
- [ ] 发现模型按钮
- [ ] 帮助链接正确跳转

#### 3.3 模型选择界面
- [ ] 统一模型选择下拉框
- [ ] 多供应商模型混合显示
- [ ] 模型按 ID 排序
- [ ] 模型卡片管理

### 4. API 调用测试

#### 4.1 统一 API 接口
- [ ] `window.PageTalkAPI.callApi` 函数
- [ ] `window.PageTalkAPI.fetchModels` 函数
- [ ] `window.PageTalkAPI.testApiKey` 函数
- [ ] 错误处理和回退机制

#### 4.2 适配器测试
- [ ] Gemini 适配器消息格式转换
- [ ] OpenAI 兼容适配器
- [ ] Anthropic 适配器特殊格式
- [ ] 流式输出处理

#### 4.3 聊天功能测试
- [ ] 主面板聊天使用多供应商
- [ ] 文字选择助手多供应商支持
- [ ] 流式输出正常显示
- [ ] 消息历史正确维护

### 5. 错误处理测试

#### 5.1 API Key 错误
- [ ] 无效 API Key 错误提示
- [ ] 缺失 API Key 错误处理
- [ ] API Key 格式验证

#### 5.2 网络错误
- [ ] 网络连接失败处理
- [ ] 超时错误处理
- [ ] 代理设置兼容性

#### 5.3 模型错误
- [ ] 不存在模型的回退处理
- [ ] 模型配置错误处理
- [ ] 供应商不支持的功能

### 6. 性能测试

#### 6.1 初始化性能
- [ ] ModelManager 初始化时间
- [ ] 供应商配置加载时间
- [ ] 模型列表渲染性能

#### 6.2 API 调用性能
- [ ] 不同供应商响应时间对比
- [ ] 流式输出延迟测试
- [ ] 并发请求处理

### 7. 兼容性测试

#### 7.1 浏览器兼容性
- [ ] Chrome 扩展功能
- [ ] Edge 扩展功能
- [ ] 跨标签页状态同步

#### 7.2 功能兼容性
- [ ] 代理设置兼容性
- [ ] 文字选择助手兼容性
- [ ] 导出功能兼容性

## 测试执行记录

### 测试环境信息
- 测试日期：
- 浏览器版本：
- 扩展版本：
- 测试人员：

### 测试结果汇总
- [ ] 所有核心功能正常
- [ ] 所有供应商配置成功
- [ ] 所有 API 调用正常
- [ ] 所有错误处理正确
- [ ] 性能表现良好
- [ ] 兼容性测试通过

### 发现的问题
1. 
2. 
3. 

### 修复建议
1. 
2. 
3. 

## 测试完成标准

- [ ] 所有测试项目执行完毕
- [ ] 所有关键功能验证通过
- [ ] 所有发现的问题已记录
- [ ] 性能指标符合预期
- [ ] 用户体验流畅自然

## 后续优化建议

1. **性能优化**：根据测试结果优化初始化和 API 调用性能
2. **错误处理**：完善错误提示信息的用户友好性
3. **功能扩展**：根据测试反馈考虑新功能需求
4. **文档更新**：更新用户文档和开发文档
